#!/bin/bash

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# REMOVE SYSTEM CONFIGURATIONS
#=================================================
ynh_script_progression "Removing system configurations related to $app..."

if [ $database != "none" ]; then
    ynh_script_progression "Removing the database..."

    db_name=$(ynh_app_setting_get --key=db_name)
    db_user=$db_name

    # Remove a database if it exists, along with the associated user
    if [ $database == "mysql" ]; then
        ynh_mysql_drop_user --db_user=$db_user --db_name=$db_name
    elif [ $database == "postgresql" ]; then
        ynh_psql_drop_db && ynh_psql_drop_user --db_user=$db_user --db_name=$db_name
    fi
fi

ynh_config_remove_nginx

ynh_safe_rm "/etc/nginx/conf.d/$domain.d/$app.d"

ynh_config_remove_phpfpm

#=================================================
# END OF SCRIPT
#=================================================

ynh_script_progression "Removal of $app completed"
